<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>JsUnit Assertion Tests</title>
<link rel="stylesheet" type="text/css" href="../../jsunit/css/jsUnitStyle.css">
<script language="JavaScript" type="text/javascript" src="../../jsunit/app/jsUnitCore.js"></script>
<script language="JavaScript" type="text/javascript" src="../../src/js/Loader.js"></script>

<script language="JavaScript" type="text/javascript">

	function setUp() {
		
	}
	function setUpPage() {
		var ins = new Loader();
		loadjs();
	}
	
	function loadjs(){
		var ins = Loader.instance;
		
		ins.loadJS("Module.js");
		ins.loadModule("net.xp.Empty");//require net.xp.Required
		ins.loadModule("net.xp.Sample");
		ins.loadJS("../../test.suite/finish.js");

		
	}
	
	function tearDown() {
	  
	}
	
	function testModule_get(){
		assertNotNull("get net.xp.Empty", Module.get("net.xp.Empty"));
		assertNotNull("get net.xp.Required", Module.get("net.xp.Required"));
		assertNull("get illegal name result null", Module.get("xx.xx.xx"));
	}

	function test_Module_require(){
		assertNotNull("Required.test", Module.get("net.xp.Required").test);
	}
	
	function testModule_prototype_method(){
		window.$M = Module.get


		var m = Module.get("net.xp.Empty");
		assertNotNull("$initialize", m.$initialize);
		assertNotNull("mixTo", m.mixTo);
		assertNotNull("compatableTo", m.compatableTo);
		assertNotNull("clz", m.clz);
		assertNotNull("newInst", m.newInst);

		//_$initialize
		assertTrue("net.xp.Sample inited", Module.initedSample);
		
		//compatable
		var clz = function (){
			
		}
		clz.prototype = {
			sampleMethod : function (){},
			
			ovf : function ($overridable){},
			
			novf : function (){}
		}
		var sm = Module.get("net.xp.Sample");
		assertTrue("compatable to clz", sm.compatableTo(clz));
		assertTrue("compatable to clz instance", sm.compatableTo(new clz()));
		
		clz.prototype.novf = null;	
		assertFalse("not compatable to clz", sm.compatableTo(clz));
		assertFalse("not compatable to clz instance", sm.compatableTo(new clz()));
		
		assertFalse("not compatable to null", sm.compatableTo(null));

		//copyTo
		var to = {};
		sm.copyTo(to);
		assertEquals("Sample.sampleMethod", sm.sampleMethod(), to.sampleMethod());


		//mixTo
		var o = function (){};
		sm.mixTo(o);
		assertEquals("sampleMethod from net.xp.Sample", sm.sampleMethod, o.prototype.sampleMethod);
		assertEquals("ovf from net.xp.Sample", sm.ovf, o.prototype.ovf);
		assertEquals("novf from net.xp.Sample", sm.novf, o.prototype.novf);
		
		assertTrue("compatable to o", sm.compatableTo(o));
		
		try{
			sm.mixTo(o);
		} catch(e){
			fail("the same module should not cause an error");
		}
		
		o.prototype.ovf = function (){}
		try{
			sm.mixTo(o);
			fail("different method should cause an error");
		} catch(e){}


		//clz
		var sClz = sm.clz({m:5});
		var sIns = new sClz();
		assertEquals("eq to 5", 5, sIns.m);
		assertEquals("prototype.sampleMethod", sm.sampleMethod, sClz.prototype.sampleMethod);


		
		//_$defaultConstructor
		var inst2 = sm.newInst([1,2,3]);
		assertEquals("should be 123", [1,2,3].join(), inst2.a.join());


		//newInst
		var x = sm.newInst(null);
		assertTrue("x.sampleMethod is not null", x.sampleMethod != null);
		assertEquals("x.sampleMethod", x.sampleMethod, sm.sampleMethod);
		
		var y = sm.newInst({a:5,b:3});
		assertEquals("y.a", 5, y.a);
		assertEquals("y.b", 3, y.b);
		assertTrue("y.sampleMethod is not null", y.sampleMethod != null);
		assertEquals("y.sampleMethod", y.sampleMethod, sm.sampleMethod);
		
		var tmp = 0;
		var clzs = function (){
			this.p = 5;
			tmp = "markInited";
		}
		var z = sm.newInst(clzs);
		assertEquals("clz inited", "markInited", tmp);
		assertEquals("z.p", 5, z.p);
		assertTrue("z.sampleMethod is not null", z.sampleMethod != null);
		assertEquals("z.sampleMethod", z.sampleMethod, sm.sampleMethod);
	}
	
	
	
	
	
	
	
	/**
	 * TODO : 
	 * 		_$m,_$g
	 * 		duplicate checking,
	 * 		no harmfull to object
	 * 		dependence
	 */
	
	
	
	




</script>
</head>

<body>
<div id="sampleDiv"><div id="anotherDiv"></div></div>
<div id="anotherDiv"></div>

</body>
</html>
