<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>JsUnit Assertion Tests</title>
<link rel="stylesheet" type="text/css" href="../css/jsUnitStyle.css">
<script language="JavaScript" type="text/javascript" src="../../jsunit/app/jsUnitCore.js"></script>
<script language="JavaScript" type="text/javascript" src="../../src/js/Loader.js"></script>

<script language="JavaScript" type="text/javascript">

	function setUp() {
		
	}
	function setUpPage() {
		var ins = new Loader({
			holders		: "",
			finishInit	: loadjs
		});
	}
	
	function loadjs(){
		var ins = Loader.instance;
		
		ins.loadJS("Module.js");
		ins.loadModule("net.xp.Empty");
		ins.loadModule("net.xp.Sample");
		ins.loadJS("../../test.suite/finish.js");
	}
	
	function tearDown() {
	  
	}
	
	function testModule_get(){
		assertNotNull("get net.xp.Empty", Module.get("net.xp.Empty"));
		assertNull("get illegal name result null", Module.get("xx.xx.xx"));
	}
	
	function testModule_prototype_method(){
		var m = Module.get("net.xp.Empty");
		assertNotNull("_$initialize", m._$initialize);
		assertNotNull("mixTo", m.mixTo);
		assertNotNull("compatableTo", m.compatableTo);
		assertNotNull("newInst", m.newInst);
		
		//_$initialize
		assertTrue("net.xp.Sample inited", Module.initedSample);
		
		//compatable
		var clz = function (){
			
		}
		clz.prototype = {
			sampleMethod : function (){},
			
			ovf : function ($overridable){},
			
			novf : function (){}
		}
		var sm = Module.get("net.xp.Sample");
		assertTrue("compatable to clz", sm.compatableTo(clz));
		assertTrue("compatable to clz instance", sm.compatableTo(new clz()));
		
		clz.prototype.novf = null;	
		assertFalse("not compatable to clz", sm.compatableTo(clz));
		assertFalse("not compatable to clz instance", sm.compatableTo(new clz()));
		
		assertFalse("not compatable to null", sm.compatableTo(null));
		
		//mixTo
		var o = function (){};
		sm.mixTo(o);
		assertEquals("sampleMethod from net.xp.Sample", sm.sampleMethod, o.prototype.sampleMethod);
		assertEquals("ovf from net.xp.Sample", sm.ovf, o.prototype.ovf);
		assertEquals("novf from net.xp.Sample", sm.novf, o.prototype.novf);
		
		assertTrue("compatable to o", sm.compatableTo(o));
		
		try{
			sm.mixTo(o);
		} catch(e){
			fail("the same module should not cause an error");
		}
		
		o.prototype.ovf = function (){}
		try{
			sm.mixTo(o);
			fail("different method should cause an error");
		} catch(e){}
		
		//newInst
		var x = sm.newInst(null);
		assertTrue("x.sampleMethod is not null", x.sampleMethod != null);
		assertEquals("x.sampleMethod", x.sampleMethod, sm.sampleMethod);
		
		var y = sm.newInst({a:5,b:3});
		assertEquals("y.a", 5, y.a);
		assertEquals("y.b", 3, y.b);
		assertTrue("y.sampleMethod is not null", y.sampleMethod != null);
		assertEquals("y.sampleMethod", y.sampleMethod, sm.sampleMethod);
		
		var tmp = 0;
		var clz = function (){
			this.p = 5;
			tmp = "inited";
		}
		var z = sm.newInst(clz);
		assertEquals("clz inited", "inited", tmp);
		assertEquals("z.p", 5, z.p);
		assertTrue("z.sampleMethod is not null", z.sampleMethod != null);
		assertEquals("z.sampleMethod", z.sampleMethod, sm.sampleMethod);
	}
	
	
	
	
	
	
	
	/**
	 * TODO : 
	 * 		_$m,_$g
	 * 		duplicate checking,
	 * 		no harmfull to object
	 * 		dependence
	 */
	
	
	
	function test_(){
		
	}



	function _testModuleCreation(){
		
		
		
		assertTrue("overridable",em.__isOverridable(em.overridable));
		assertFalse("not overridabel",em.__isOverridable(em.notOverridable));
		
		//_$m
		var em2 = Module.get("net.xp.Empty2");
		
		function funcA(){}
		function funcB(){};
		
		em.mixTo(funcA);
		em2.mixTo(funcA);
		
		em.mixTo(funcB);
		em2.mixTo(funcB);
		
		var emInst = new funcA();
		var emInst2 = new funcB();
		//same Module's _$m property should not the same in different class.
		emInst.set$m("a",10);
		assertEquals("em-1's _$m.a", 10, emInst.get$m("a"));
		emInst2.set$m("a",20);
		assertEquals("em-2's _$m.a", 20, emInst2.get$m("a"));
		assertNotEquals("em-1 & em-2 should be of different value of _$m.a", emInst.get$m("a"), emInst2.get$m("a"));
		//differenct Module's _$m property should not be the same either.
		emInst.set2$m("a",15);
		assertNotEquals("em1's set$m & set2$m should get different value",emInst.get$m("a"), emInst.get2$m("a"));
		//different Module's _$g should not the same but the same Module's _$g in different object should be the same.
		emInst.set$g("b",2);
		emInst.set2$g("b",4);
		assertEquals("em-2's _$g shoud be 2", 2, emInst2.get$g("b"));
		assertEquals("em-1's _$g v2 should be 4", 4, emInst.get2$g("b"));
		
		
		
		//mix
		var mhc = Module.get("net.xp.core.HashCode")
		function testFunc(){
			
		}
		mhc.mixTo(testFunc);
		assertEquals("hashCode method", mhc.hashCode, testFunc.prototype.hashCode);
		var testVar = new testFunc();
		assertEquals("hashCode method in instance", mhc.hashCode, testVar.hashCode);
		
		var testE = Module.get("net.xp.core.Enumerable").newInst();
		assertEquals("hashCode method in Enumerable instance", mhc.hashCode, testE.hashCode);
		
	}	
	


</script>
</head>

<body>
<div id="sampleDiv"><div id="anotherDiv"></div></div>
<div id="anotherDiv"></div>

</body>
</html>
